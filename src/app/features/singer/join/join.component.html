<div class="join-container p-fluid">
  
  <!-- Formulario de inscripci贸n -->
  <p-card *ngIf="!showConfirmation" styleClass="join-card">
    <ng-template pTemplate="header">
      <div class="card-header">
        <div class="header-left">
          <h3 class="header-title">KaraQR</h3>
        </div>
        <span class="header-subtitle">Basement415</span>
      </div>
    </ng-template>
    <form [formGroup]="joinForm" (ngSubmit)="onSubmit()" (keydown)="onKeyDown($event)" novalidate>
      
      <!-- Campo Nombre -->
      <div class="field">
        <label for="name" class="block font-medium mb-2">
          Nombre *
        </label>
        <input 
          pInputText 
          id="name"
          formControlName="name"
          placeholder="Ingresa tu nombre"
          class="w-full"
          [class.ng-invalid]="hasFieldError('name', 'required') || hasFieldError('name', 'minlength')"
          autocomplete="given-name"
        />
        <small 
          class="p-error block mt-1" 
          *ngIf="hasFieldError('name', 'required') || hasFieldError('name', 'minlength')"
        >
          {{ getFieldErrorMessage('name') }}
        </small>
      </div>

      <!-- Campo Canci贸n -->
      <div class="field">
        <label for="song" class="block font-medium mb-2">
          Canci贸n (Artista - Tema) *
        </label>
        <input 
          pInputText 
          id="song"
          formControlName="song"
          placeholder="Ej: Queen - Bohemian Rhapsody"
          class="w-full"
          [class.ng-invalid]="hasFieldError('song', 'required') || hasFieldError('song', 'minlength')"
        />
        <small 
          class="p-error block mt-1" 
          *ngIf="hasFieldError('song', 'required') || hasFieldError('song', 'minlength')"
        >
          {{ getFieldErrorMessage('song') }}
        </small>
      </div>

      <!-- Campo YouTube Link (opcional) -->
      <div class="field">
        <label for="youtubeLink" class="block font-medium mb-2">
          Link de YouTube (opcional pero recomendable)
        </label>
        <input 
          pInputText 
          id="youtubeLink"
          formControlName="youtubeLink"
          placeholder="https://www.youtube.com/watch?v=..."
          class="w-full"
          [class.ng-invalid]="hasFieldError('youtubeLink', 'invalidUrl')"
        />
        <small 
          class="p-error block mt-1" 
          *ngIf="hasFieldError('youtubeLink', 'invalidUrl')"
        >
          {{ getFieldErrorMessage('youtubeLink') }}
        </small>
        <small class="text-500 block mt-1" *ngIf="!hasFieldError('youtubeLink', 'invalidUrl')">
          Si tienes una versi贸n espec铆fica que prefieres
        </small>
      </div>

      <!-- Bot贸n Submit -->
      <div class="field mt-4">
        <button 
          pButton 
          type="submit"
          label="Anotarme "
          class="w-full p-button-lg join-submit-btn"
          [disabled]="joinForm.invalid || joinForm.pristine || isSubmitting"
          [loading]="isSubmitting"
          loadingIcon="pi pi-spinner pi-spin"
          (click)="onButtonClick($event)"
        >
        </button>
      </div>

    </form>

    <!-- Footer con informaci贸n del tenant -->
    <div class="tenant-footer">
      <small class="text-500">
        <i class="pi pi-qrcode mr-1"></i>
        Escaneado para <strong>{{ tenantId }}</strong>
      </small>
    </div>

  </p-card>

  <!-- Pantalla de confirmaci贸n -->
  <p-card *ngIf="showConfirmation" class="confirmation-card">
    <ng-template pTemplate="header">
      <div class="card-header">
        <div class="header-left">
          <h3 class="header-title">KaraQR</h3>
        </div>
        <span class="header-subtitle">Basement415</span>
      </div>
    </ng-template>
    <div class="confirmation-content">
      
      <!-- cono de 茅xito -->
      <div class="success-icon">
        <i class="pi pi-check-circle"></i>
      </div>
      
      <!-- Mensaje principal -->
      <h2 class="confirmation-title">隆{{ submittedData?.song }} lista para cantar! </h2>
      <p class="confirmation-message">
        Te has anotado exitosamente en la cola de karaoke
      </p>
      
      <!-- Detalles de la inscripci贸n -->
      <div class="inscription-details">
        <div class="detail-item">
          <i class="pi pi-user detail-icon"></i>
          <span class="detail-label">Cantante:</span>
          <span class="detail-value">{{ submittedData?.name }}</span>
        </div>
        
        <div class="detail-item">
          <i class="pi pi-music detail-icon"></i>
          <span class="detail-label">Canci贸n:</span>
          <span class="detail-value">{{ submittedData?.song }}</span>
        </div>
        
        <div class="detail-item" *ngIf="submittedData?.youtubeLink">
          <i class="pi pi-youtube detail-icon"></i>
          <span class="detail-label">YouTube:</span>
          <a 
            [href]="submittedData?.youtubeLink" 
            target="_blank" 
            rel="noopener noreferrer"
            class="detail-value youtube-link"
          >
            {{ submittedData?.youtubeLink }}
            <i class="pi pi-external-link ml-1"></i>
          </a>
        </div>
      </div>
      
      <!-- Informaci贸n adicional -->
      <div class="info-message">
        <i class="pi pi-info-circle mr-2"></i>
        Te avisaremos cuando sea tu turno. 隆Mantente atento!
      </div>
      
      <!-- Botones de acci贸n -->
      <div class="action-buttons">
        <button 
          pButton 
          label=" Anotar otra canci贸n"
          class="p-button-outlined w-full"
          (click)="requestAnotherSong()"
        ></button>
      </div>
      
    </div>
  </p-card>

  <!-- Toast para errores solamente -->
  <p-toast position="top-center" [life]="5000"></p-toast>
</div>